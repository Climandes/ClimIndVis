# Estos tres argumentos son obligatorios.
# Además, elegimos el tipo de gráfico y decidimos trazar sólo una estación (con selpoints). En general, el comando tiene el siguiente aspecto:
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(2))
# Además, elegimos el tipo de gráfico y decidimos trazar sólo una estación (con selpoints). En general, el comando tiene el siguiente aspecto:
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(3))
# Además, elegimos el tipo de gráfico y decidimos trazar sólo una estación (con selpoints). En general, el comando tiene el siguiente aspecto:
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(5))
# Además, elegimos el tipo de gráfico y decidimos trazar sólo una estación (con selpoints). En general, el comando tiene el siguiente aspecto:
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(8))
# Además, elegimos el tipo de gráfico y decidimos trazar sólo una estación (con selpoints). En general, el comando tiene el siguiente aspecto:
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(11))
# Además, elegimos el tipo de gráfico y decidimos trazar sólo una estación (con selpoints). En general, el comando tiene el siguiente aspecto:
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(14))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(15))
# Además, elegimos el tipo de gráfico y decidimos trazar sólo una estación (con selpoints). En general, el comando tiene el siguiente aspecto:
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(16))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(17))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(18))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(20))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1, iformat="days")
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(20))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(3))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(3))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1, iformat="days")
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(3))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1, iformat="days")
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(3))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(12))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(7))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(7))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=1, iformat="days")
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(7))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(7))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1, iformat="days")
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(7))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(1))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1, iformat="days")
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(1))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(2))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(4))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1, iformat="days")
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(4))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(5))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(5))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(5))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1, iformat="days")
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts", selpoints = c(5))
output <- "png"  # formate de su gráfico. Puede leer en la documentacion cual otros formatos de graficos existen.
plotdir <- paste0(dir,"/Figures/")
# Estos dos son obligatorios. Además puede elegir un nombre para recordar tu imagen y un titulo, además de los valores prefijados:
plotname <- "Test1"
title <- "StationSur"
plotdir
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(2))
getwd()
setwd("/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/imn_code/moodle_climindvis/")
plotdir <- paste0(dir,"/Figures/")
plotdir
# Estos dos son obligatorios. Además puede elegir un nombre para recordar tu imagen y un titulo, además de los valores prefijados:
plotname <- "Test1"
setwd("/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/imn_code/moodle_climindvis/")
dir <- getwd()
dir
plotdir <- paste0(dir,"/Figures/")
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(2))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "multi_point",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(12:15))
# Quizas queremos ver no solo una estacion en el gráfico, pero varios. Podemos cambiar selpoints a c(2:5) y cambiar ts_type:
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "multi_point",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(12:15))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "multi_point",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
# Quizas queremos ver no solo una estacion en el gráfico, pero varios. Podemos cambiar selpoints a c(2:5) y cambiar ts_type:
index_args <- list(aggt= "other", aggmons=c(9,10), dd_threshold=1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "multi_point",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
# Quizas queremos ver no solo una estacion en el gráfico, pero varios. Podemos cambiar selpoints a c(2:5) y cambiar ts_type:
index_args <- list(aggt= "other", aggmons=c(10,11), dd_threshold=1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "multi_point",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
# Perfecto! Ahora hacemos una visualización.
index <- "fd"
index_args <- list(list(aggt= "seasonal", selagg=c("DJF","SON")), list(aggt= "other", aggmons=c(9:12)))
index_args <- list(list(aggt= "seasonal", selagg=c("DJF","SON")), list(aggt= "other", aggmons=c(9:12)))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
index_args <- list(list(aggt= "seasonal", selagg=c("DJF","SON")), list(aggt= "other", aggmons=c(9:12)))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(12:15))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
plotname <- "Trends"
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
index_args <- list(list(aggt= "seasonal", selagg=c("DJF","SON"), iformat="days"), list(aggt= "other", aggmons=c(9:12), iformat="days"))
plotname <- "Trends"
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
leapyear_shift =TRUE
dat.final <- matrix(NA,nrow = 4,ncol=length(DAT[,1]))
all(is.na(data))
sum(is.na(data))>length(data)*(targs$NAmaxTrend)/100
sum(is.na(data))
targs$method
targs$count
leapyear_shift == T
library(ClimIndVis)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
coef[1]+t2*coef[2]
p0
alogit(coef[1]+t2*coef[2])
alogit
coef[1]+t1*coef[2]
t2
t1
t0
coef[1]
coef[1]+t0*coef[2]
coef[1]
alogit(coef[1]+t0*coef[2])
p0 <- alogit(coef[1]+t0*coef[2])   # probability at middle year
p0
t0
coef[2]
# trend magnitude as fractional change of average
trd <- (alogit(coef[1]+t2*coef[2])-alogit(coef[1]+t1*coef[2]))/p0
trd
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
lines <- rev(seq(switch((length(trinfo[,1])>2)+1,1,0),3,length.out=length(trinfo[,1])+1))*text_cex
lines
text
lines[-which.max(lines)]
vals
trd
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
fit1
dat.final[1,]  = exp(fit1)/(1+exp(fit1))*365
dat.final[1,]
exp(fit1)
dat.final[1,]  = exp(fit1)/(1+exp(fit1))*365
plot(dat_final[1,])
dat.final[1,]  = exp(fit1)/(1+exp(fit1))*365
dat.final[1,]  = exp(fit1)/(1+exp(fit1))*365
n
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
plot(dat.final[,1])
plot(1:30,dat.final[,1])
plot(1:30,dat.final[1,])
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
plot(1:30,dat.final[1,])
trd1$pval
stat <- data.frame(
inicio = DAT[1,1],
fin = DAT[dim(DAT)[1],1],
p.value = trd1$pval,
trend.rel = (trd1$trend.rel*100),
trend.abs = trd1$trend.rel*mean(dat.final[1,], na.rm=TRUE)/dim(DAT)[1]*10,
method = 2)
trend.rel
(trd1$trend.rel*100)
trd1$trend.rel*mean(dat.final[1,], na.rm=TRUE)/dim(DAT)[1]*10
index <- "fd"
index_args <- list(list(aggt= "seasonal", selagg=c("DJF","SON"), iformat="days"), list(aggt= "other", aggmons=c(9:12), iformat="days"))
plotname <- "Trends"
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15))
s <- 0
if(leapyear_shift == T){s <- 1}#if year starts in July (southern hemisphere)
a_bisiesto <- data.frame(DAT[,1], numdays=ifelse(((DAT[,1] +s)%%4==0 & (DAT[,1] +s)%%100!=0) | (DAT[,1] +s)%%400==0,366,365) )
DAT <- data.frame(years=DAT[,1],ind=DAT[,2],V3=a_bisiesto[,2] - DAT[,2])
trd1  <- trend.logit(DAT[,1:3], type = "counts")
pred1 <- predict(trd1$mod, data.frame(year = DAT[,1]), interval = "confidence", se.fit = T)
pred1 <- predict(trd1$mod, data.frame(year = DAT[,1]), interval = "confidence", se.fit = T)
fit1   <- pred1$fit
se.fit1<- pred1$se.fit
lw1 <- predict(loess(ind ~ years, data = DAT), data.frame(years = DAT[,1]))
lw1
dat.final[1,]  = exp(fit1)/(1+exp(fit1))*365
dat.final[1,]
datadir <-"/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/data/"
outdir <- "/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/figures/ClimIndVis/"
#----read topo
topo.nc <- nc_open("/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/data/Topographie/USGS_Topography.nc")
topo.dat <- ncvar_get(topo.nc, "elev")
topo.lon <- ncvar_get(topo.nc, "lon")
topo.lat <- ncvar_get(topo.nc, "lat")
cutx <- c(270,300)
cuty <- c(5, -20)
topo.cut <- topo.dat[topo.lon > cutx[1]& topo.lon < cutx[2], topo.lat < cuty[1] & topo.lat > cuty[2]]
topo.lon.cut <- topo.lon[topo.lon > cutx[1]& topo.lon < cutx[2]]
topo.lat.cut <- topo.lat[topo.lat < cuty[1] & topo.lat > cuty[2]]
topo.list <- list(alt = topo.cut, lon= topo.lon.cut, lat=topo.lat.cut)
library(stringr)
library(Hmisc)
library(ncdf4)
library(ClimandesSpec)
library(geomapdata)
library(ClimIndVis)
obsname<-"all_stations"
ys=1964
ye=2013
years=ys:ye
#data directory
datadir <-"/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/data/"
outdir <- "/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/figures/ClimIndVis/"
#----read topo
topo.nc <- nc_open("/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/data/Topographie/USGS_Topography.nc")
topo.dat <- ncvar_get(topo.nc, "elev")
topo.lon <- ncvar_get(topo.nc, "lon")
topo.lat <- ncvar_get(topo.nc, "lat")
cutx <- c(270,300)
cuty <- c(5, -20)
topo.cut <- topo.dat[topo.lon > cutx[1]& topo.lon < cutx[2], topo.lat < cuty[1] & topo.lat > cuty[2]]
topo.lon.cut <- topo.lon[topo.lon > cutx[1]& topo.lon < cutx[2]]
topo.lat.cut <- topo.lat[topo.lat < cuty[1] & topo.lat > cuty[2]]
topo.list <- list(alt = topo.cut, lon= topo.lon.cut, lat=topo.lat.cut)
22-37
-15/30
#Stationsdaten
prec=get_obs_hom_Peru(statlist=paste0(obsname,".txt"),datadir=datadir,var="tp",ys=ys,ye=ye)
tmin=get_obs_hom_Peru(statlist=paste0(obsname,".txt"),datadir=datadir,var="tmin",ys=ys,ye=ye)
tmax=get_obs_hom_Peru(statlist=paste0(obsname,".txt"),datadir=datadir,var="tmax",ys=ys,ye=ye)
tavg=get_obs_hom_Peru(statlist=paste0(obsname,".txt"),datadir=datadir,var="tavg",ys=ys,ye=ye)
rownames(prec$var)
climandes_obs <-make_object(
prec = prec$var, tmin = tmin$var, tmax = tmax$var, tavg = tavg$var,
dates_prec = prec$time, dates_tmin = tmin$time, dates_tmax = tmax$time, dates_tavg = tavg$time,
lon = prec$lon, lat = prec$lat,
data_info = list( type = "p", date_format = "t1d", data_name = "Station",pnames= rownames(prec$var), long_data_name = paste0("hom Station")))
#----Stationsdaten test----
obsname <- "test"
prect=get_obs_hom_Peru(statlist=paste0(obsname,".txt"),datadir=datadir,var="tp",ys=ys,ye=ye)
tmint=get_obs_hom_Peru(statlist=paste0(obsname,".txt"),datadir=datadir,var="tmin",ys=ys,ye=ye)
tmaxt=get_obs_hom_Peru(statlist=paste0(obsname,".txt"),datadir=datadir,var="tmax",ys=ys,ye=ye)
tavgt=get_obs_hom_Peru(statlist=paste0(obsname,".txt"),datadir=datadir,var="tavg",ys=ys,ye=ye)
rownames(prect$var)
climandes_obs_test <-make_object(
prec = prect$var, tmin = tmint$var, tmax = tmaxt$var, tavg = tavgt$var,
dates_prec = prect$time, dates_tmin = tmint$time, dates_tmax = tmaxt$time,dates_tavg = tavgt$time,
lon = prect$lon, lat = prect$lat,
data_info = list( type = "p", date_format = "t1d", data_name = "Station",pnames= rownames(prect$var), long_data_name = paste0("hom Station")))
index <- "fd"
index_args <- list(list(aggt= "seasonal", selagg=c("DJF","SON"), iformat="days"), list(aggt= "other", aggmons=c(9:12), iformat="days"))
plotname <- "Trends"
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(1))
autoplot_ts_stations(climandes_obs_test, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(1))
climandes_obs_test$data$tmin
climandes_obs_test$data$tmin[1,1:360]
climandes_obs_test$data$tmin[1,360:700]
index_args <- list(list(aggt= "seasonal", selagg=c("JJA","SON"), iformat="days"), list(aggt= "other", aggmons=c(7:8), iformat="days"))
plotname <- "Trends"
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15))
index_args <- list(list(aggt= "seasonal", selagg=c("JJA","SON"), iformat="days"), list(aggt= "other", aggmons=c(7:8), iformat="days"))
plotname <- "Trends"
autoplot_ts_stations(climandes_obs_test, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(1))
index_args <- list(list(aggt= "seasonal", selagg=c("SON"), iformat="days"), list(aggt= "other", aggmons=c(7:8), iformat="days"))
autoplot_ts_stations(climandes_obs_test, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(1))
a_bisiesto <- data.frame(DAT[,1], numdays=ifelse(((DAT[,1] +s)%%4==0 & (DAT[,1] +s)%%100!=0) | (DAT[,1] +s)%%400==0,366,365) )
a_bisiesto
DAT <- data.frame(years=DAT[,1],ind=DAT[,2],V3=a_bisiesto[,2] - DAT[,2])
trd1  <- trend.logit(DAT[,1:3], type = "counts")
pred1 <- predict(trd1$mod, data.frame(year = DAT[,1]), interval = "confidence", se.fit = T)
fit1   <- pred1$fit
se.fit1<- pred1$se.fit
lw1 <- predict(loess(ind ~ years, data = DAT), data.frame(years = DAT[,1]))
dat.final[1,]  = exp(fit1)/(1+exp(fit1))*365
dat.final[2,] = exp(fit1-1.96*se.fit1)/(1+exp(fit1-1.96*se.fit1))*365
dat.final[3,]  = exp(fit1+1.96*se.fit1)/(1+exp(fit1+1.96*se.fit1))*365
dat.final[4,]   = lw1
dat.final
trd1$pval
trd1$trend.rel
autoplot_ts_stations(climandes_obs_test, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(1))
p0
p0
trd
# trend magnitude as fractional change of average
trd <- (alogit(coef[1]+t2*coef[2])-alogit(coef[1]+t1*coef[2]))/p0
trd
p0 <- 0.001
# trend magnitude as fractional change of average
trd <- (alogit(coef[1]+t2*coef[2])-alogit(coef[1]+t1*coef[2]))/p0
trd
p0 < 0.001 & p0 > -0.001
# trend magnitude as fractional change of average
test <- p0 < 0.001 & p0 > -0.001
test
switch(test+1,trd <- (alogit(coef[1]+t2*coef[2])-alogit(coef[1]+t1*coef[2]))/p0, trd <- NA)
trd
0.001/0.0005
library(ClimIndVis)
autoplot_ts_stations(climandes_obs_test, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(1))
index_args <- list(list(aggt= "seasonal", selagg=c("SON","DJF"), iformat="days"), list(aggt= "other", aggmons=c(9:12), iformat="days"))
plotname <- "Trends"
autoplot_ts_stations(climandes_obs_test, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(1))
plotname <- "Trends"
autoplot_ts_stations(climandes_obs_test, index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_agg",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(1))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(5))
climindvis_obs
# También podemos guardar el gráfico directamente en una carpeta. Para ello, debe introducir los argumentos siguientes.
output <- "png"  # formate de su gráfico. Puede leer en la documentacion cual otros formatos de graficos existen.
plotdir <- paste0(dir,"/Figures/")
# Estos dos son obligatorios. Además puede elegir un nombre para recordar tu imagen y un titulo, además de los valores prefijados:
plotname <- "Test1"
title <- "StationSur"
index <- "dd"
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "multi_point",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:19))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(5))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=1)
index_args
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(5))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(5))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "tssingle_ts",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(5))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(5))
# Estos dos son obligatorios. Además puede elegir un nombre para recordar tu imagen y un titulo, además de los valores prefijados:
plotname <- "Test01"
title <- "StationSur"
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(5))
index_args <- list(aggt= "other", aggmons=c(8,9), dd_threshold=0.1)
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "single_ts",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(5))
source('/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/imn_code/moodle_climindvis/help_fun_nn.R', echo=TRUE)
(dir <- "/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/")
(dir <- "/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/")
path <- paste0(dir, "/data/PISCO/PISCOp_v2.1/PISCOpd_v2.1_eragrid075.nc")
# abrimos el netcdf
prec_nc <- nc_open(path)
# y buscamos nombre y dimensiones del variable
param <- names(prec_nc$var)
fdims <- prec_nc$var[[param]]$dim
(fdimnames <- sapply(fdims, function(x) x$name))
# Obtiene las diferentes variables
prec_var <- ncvar_get(prec_nc,param)
prec_lon <- ncvar_get(prec_nc,varid=fdimnames[[grep('lon', fdimnames)]])
prec_lat <- ncvar_get(prec_nc,varid=fdimnames[[grep('lat', fdimnames)]])
# controlamos el formato de las fechas y convertir en "Date"
time <- ncvar_get(prec_nc,"z")
(unit <- ncatt_get(prec_nc, "z")$units)
# Todavía tenemos que cortar el string de caracteres para que sólo tengamos la fecha.
refdate <- as.POSIXct(gsub('.*since ', '', unit), tz='UTC')
prec_time <- as.Date(time, origin=refdate)
str(prec_var)
str(prec_lon)
str(prec_lat)
str(prec_time)
type <- "grid"
date_format <- "t1d"
data_name <- "PISCOp Diario S5grid"
# pnames no necesitamos
### multi-dat
climindvis_nn <- get_nn_object(climindvis_grid=climindvis_grid,lonp=climindvis_obs$lon,latp=climindvis_obs$lat,data_name="PISCO")
data_info <- list(type=type, date_format=date_format, data_name=data_name)
lat1 <- -19
lat2 <- -10
lon1 <- 360 -78
lon2 <- 360 - 68
climindvis_grid <-make_object(
prec = prec_var[prec_lon<lon2 & prec_lon>lon1,prec_lat<lat2 & prec_lat>lat1,],
dates_prec = prec_time,
lon = prec_lon[prec_lon<lon2 & prec_lon>lon1], lat = prec_lat[prec_lat<lat2 & prec_lat>lat1],
data_info = data_info)
### multi-dat
climindvis_nn <- get_nn_object(climindvis_grid=climindvis_grid,lonp=climindvis_obs$lon,latp=climindvis_obs$lat,data_name="PISCO")
index_args <- list(list(aggt= "seasonal", selagg=c("DJF"), iformat="days"))
?autoplot_ts_stations
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = FALSE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15))
plotdir
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = FALSE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15))
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = FALSE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15))
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = FALSE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15))
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = FALSE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15))
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = FALSE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15))
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = FALSE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15))
index
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = FALSE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15))
dat<-cut_to_same_dates(dat,selyears=selyears)
length(index) == 1
is.list(index_args[[1]])
index_args <- list(aggt= "seasonal", selagg=c("DJF"), iformat="days")
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = FALSE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15))
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = FALSE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15))
index_args <- list(aggt= "seasonal", selagg=c("DJF"), iformat="days")
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(2))
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(2))
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(2))
trend_type <- c("rel.trend", "abs.trend")
trend_type
trinfo
library(ClimIndVis)
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(2))
trend_type <- c("rel.trend", "abs.trend")
ifelse(all(trinfo[,4:5]== -99.9),types <- c(FALSE,FALSE),
ifelse(all(trinfo[,4]== -99.9),types <- c(FALSE, TRUE), ifelse(all(trinfo[,5]==-99.9),types <- c(TRUE,FALSE),types <- c(TRUE,TRUE))))
text <- paste("p-value", paste0(trend_type[types], collapse=" / "), sep = "  / ")
trinfo <- as.data.frame(trinfo)
for (i in 4:5) {trinfo[,i] <- ifelse(trinfo[,i]>=0,paste0(" ",trinfo[,i]),trinfo[,i])}
trinfo[trinfo==-99.9] <- NA
trinfo[is.na(trinfo)] <- " ----  "
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(2))
index_args <- list(aggt= "seasonal", selagg=c("DJF"), iformat="days")
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(2:4))
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:17))
### multi-dat
climindvis_nn <- get_nn_object(climindvis_grid=climindvis_grid,lonp=climindvis_obs$lon,latp=climindvis_obs$lat,data_name="PISCO", pnames = climindvis_obs$data_info$pnames)
index <- "dd"
index_args <- list(aggt= "seasonal", selagg=c("DJF"), iformat="days")
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:17))
index_args <- list(aggt= "seasonal", selagg=c("DJF"))
autoplot_ts_stations(list(climindvis_obs, climindvis_nn), index=index, index_args = index_args, trendplots = TRUE,
ts_type = "multi_dat",output=output, plotdir=plotdir, plotname=plotname, title=title, selpoints = c(15:17))
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "spi_barplot",output=output, plotdir=plotdir, selpoints = c(15:17))
index_args <- list(aggt= "monthly")
index <- "spi"
index_args <- list(aggt= "monthly")
autoplot_ts_stations(climindvis_obs, index=index, index_args = index_args,
ts_type = "spi_barplot",output=output, plotdir=plotdir, selpoints = c(15:17))
