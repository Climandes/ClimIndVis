{
    "collab_server" : "",
    "contents" : "#------obj------\ndata(\"tmax_grid\",\"tmin_grid\",\"tmax_obs\",\"tmin_obs\",\"tp_obs\",\"tp_grid\")\nprec_obs <- make_climandes_object(prec= tp_obs$tp_obs[,1:5325], dates_prec=tp_obs$time[1:5325], lon=tp_obs$lon,lat=tp_obs$lat, data_info= tp_obs$data_info)\nprec_grid <- make_climandes_object(prec= tp_grid$tp_grid[,,1:5325], dates_prec=tp_grid$time[1:5325], lon=tp_grid$lon,lat=tp_grid$lat, data_info= tp_grid$data_info)\n\ntemp_obs <- make_climandes_object(tmin= tmin_obs$tmin_obs, dates_tmin=tmin_obs$time, lon=tmin_obs$lon,lat=tmin_obs$lat, data_info= tmin_obs$data_info)\ntemp_grid <- make_climandes_object(tmin= tmin_grid$tmin_grid, dates_tmin=tmin_grid$time, lon=tmin_grid$lon,lat=tmin_grid$lat, data_info= tmin_grid$data_info)\n\n#------forecast object------------\ntp_obs_fc <- list()\ntp_obs_fc$data_info <-tp_obs$data_info\ntp_obs_fc$data_info$type <-\"p_fc\"\ntp_obs_fc$data_info$date_format <-\"t2d\"\n# time kommt von test hindcast fcst data -> hier könnte ich auch hindcast objekt machen\nsource(\"/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/imn_code/climandes-2/experiments/imn/calc_index_test_hcc_data.R\")\ntp_obs_fc$time <- time[\"1995\"]\ntp_obs_fc$tp_obs_fc <- tp_hc[1:3,,,which(names(time) ==\"1995\")]\nprec_obs_fcst <- make_climandes_object(prec= tp_obs_fc$tp_obs_fc, dates_prec=tp_obs_fc$time, lon=tp_obs$lon,lat=tp_obs$lat, data_info= tp_obs_fc$data_info)\n\ntp_obs_hc <- list()\ntp_obs_hc$data_info <-tp_obs$data_info\ntp_obs_hc$data_info$type <-\"p_hc\"\ntp_obs_hc$data_info$date_format <-\"t2d\"\ntp_obs_hc$time <- time[14:19]\ntp_obs_hc$tp_obs_hc <- tp_hc[1:3,,,which(names(time) %in%c(\"1994\",\"1995\",\"1996\",\"1997\",\"1998\",\"1999\"))]\nprec_obs_hcst <- make_climandes_object(prec= tp_obs_hc$tp_obs_hc, dates_prec=tp_obs_hc$time, lon=tp_obs$lon,lat=tp_obs$lat, data_info= tp_obs_hc$data_info)\n\ntp_grid_fc <- list()\ntp_grid_fc$data_info <-tp_grid$data_info\ntp_grid_fc$data_info$type <-\"grid_fc\"\ntp_grid_fc$data_info$date_format <-\"t2d\"\nruni <- array(runif((4*4*213*32*1),1,5),dim=c(dim(tp_grid$tp_grid[,,5475:(5475-213)])[1:2],32,dim(tp_grid$tp_grid[,,5475:(5475-213)])[3],1))\ntp_grid_fc$tp_grid_fc <- runi\n## time kommt von test hindcast fcst data -> hier könnte ich auch hindcast objekt machen\ntp_grid_fc$time <- time[\"1995\"]\nprec_grid_fcst <- make_climandes_object(prec= tp_grid_fc$tp_grid_fc, dates_prec=tp_grid_fc$time, lon=tp_grid$lon,lat=tp_grid$lat, data_info= tp_grid_fc$data_info)\n\n#-----spi-----\nspi_obs <- calc_index(prec_obs,\"spi\", aggregation=\"monthly\", timescale= 3, distribution=\"gamma\", trend=TRUE)\nspi_grid <- calc_index(prec_grid,\"spi\", aggregation=\"monthly\", timescale= 6, distribution=\"gamma\", trend=TRUE)\nplot_ts_stations(spi_obs, trendplots = TRUE, output=\"png\", plotdir=\"/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/figures/ClimandesIndizes/spi/\", plotnamestring = \"testdata\" )\n\n#----------spi forecast--------\nspi_obsfc <- calc_index(prec_obs,\"spi_forecast\",aggregation=\"monthly\", forecast= prec_obs_fcst,timescale= 3, distribution=\"gamma\", trend=FALSE)\nstr(prec_obs$data)\nstr(spi_obsfc$index_fcst)\nspi_obsfc$index_info$fcst_time\nstr(spi_obsfc$index_info)\n\nplot_spi_forecast(spi_obsfc, trendplots=FALSE, output=\"png\", plotstart= 1993,plotdir=\"/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/figures/ClimandesIndizes/spi/\", plotnamestring = \"forecast\")\nplot_spi_forecast(spi_obsfc, trendplots=FALSE, plotstart= 1993)\nplot(x=1:(12*15), y=as.vector(spi_obs$index[1,,]), ylim=c(-4,4),xlim=c(0,250),type=\"l\")\nfor(mem in 1:51) {points(x=((12*15)+1):((12*15)+18),as.vector(spi_obs$index_fcst[1,mem,,]), type=\"l\")}\n\nspi_grid <- calc_index(prec_grid,\"spi_forecast\", aggregation=\"monthly\", forecast= prec_grid_fcst,timescale= 3, distribution=\"gamma\", trend=FALSE)\nstr(spi_grid$index_fcst)\nstr(spi_grid$index)\nplot(x=1:(12*15), y=as.vector(spi_grid$index[1,1,,]), ylim=c(-4,4),xlim=c(0,250),type=\"l\")\nfor(mem in 1:32) {points(x=((12*15)+1):((12*15)+18),as.vector(spi_grid$index_fcst[1,1,mem,,]), type=\"l\")}\n\n\n#-----rainy season-----\nrs_obs <- calc_index(prec_obs,\"rainy_season_start\",rs_method=\"stern\",aggregation=\"dates\",start_days=\"0000-01-10\",end_days=\"0000-12-31\", trend=TRUE)\nplot_ts_stations(rs_obs, trendplots = TRUE)\nrs_obs$index\nstr(rs_obs$index_trend)\nrs_grid <- calc_index(prec_grid,\"rainy_season_start\",rs_method=\"stern\",aggregation=\"dates\",start_days=\"0000-01-10\",end_days=\"0000-12-31\", trend=TRUE)\nrs_grid$index\nstr(rs_grid$index_trend)\n\n#------new indices--------\n# prcptot\nprcptot_obs <- calc_index(prec_obs,\"prcptot\",aggregation=\"seasonal\",  trend=TRUE)\nprcptot_grid <- calc_index(prec_grid,\"prcptot\",aggregation=\"seasonal\",  trend=FALSE)\nprcptot_obs_fcst <- calc_index(prec_obs_fcst,\"prcptot\",aggregation=\"monthly\",  trend=FALSE)\nprcptot_grid_fcst <- calc_index(prec_grid_fcst,\"prcptot\",aggregation=\"monthly\",  trend=FALSE)\nprcptot_obs_hcst <- calc_index(prec_obs_hcst,\"prcptot\",aggregation=\"monthly\",  trend=FALSE)\n#prcptot_grid_hcst <- calc_index(prec_grid_hcst,\"prcptot\",aggregation=\"monthly\",  trend=FALSE) -> das nicht getestet...\n\nstr(prcptot_obs$index)\nstr(prcptot_obs_fcst$index)\ntail(prec_obs$time)\n\ndd_obs <- calc_index(prec_obs,\"dd\",aggregation=\"monthly\",  trend=TRUE)\ncdd_obs <- calc_index(prec_obs,\"cdd\",aggregation=\"seasonal\",  trend=TRUE)\ncwd_obs <- calc_index(prec_obs,\"cwd\",aggregation=\"monthly\",  trend=TRUE)\ncwd_obs$index\n\ntnn_obs <- calc_index(temp_obs,\"tnn\",aggregation=\"monthly\",  trend=TRUE)\ntnn_obs$index\ntnn_obs <- calc_index(temp_obs,\"tnx\",aggregation=\"seasonal\",  trend=TRUE)\ntnn_obs$index\nplot_ts_stations(tnn_obs, trendplots=TRUE, output=\"png\", plotdir=\"/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/figures/ClimandesIndizes/test3/\", plotnamestring = \"testdata\")\ntnn_obs <- calc_index(temp_obs,\"txx\",aggregation=\"monthly\",  trend=TRUE)\ntnn_obs$index\ntnn_obs <- calc_index(temp_obs,\"txn\",aggregation=\"monthly\",  trend=TRUE)\ntnn_obs$index\nrx5_obs <- calc_index(prec_obs,\"rx\",aggregation=\"monthly\",rx=5,  trend=TRUE)\nrx5_obs$index\nplot_ts_stations(rx5_obs, trendplots=TRUE, output=\"png\", plotdir=\"/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/figures/ClimandesIndizes/test3/\", plotnamestring = \"testdata\")\n\nsdii_obs <- calc_index(prec_obs,\"sdii\",aggregation=\"monthly\",  trend=TRUE)\nsdii_obs$index\nplot_ts_stations(sdii_obs, trendplots=TRUE, output=\"png\", plotdir=\"/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/figures/ClimandesIndizes/test3/\", plotnamestring = \"testdata\")\n\nqth_obs <- calc_index(prec_obs,\"qth\",thvar=\"prec\" ,aggregation=\"seasonal\",iformat=\"perc\", op=\"<\",\n                      threshold=10  ,trend=TRUE, baseperiod=c(1982,1988), q=seq(0,1,0.1))\nplot_ts_stations(qth_obs, trendplots=TRUE, output=\"png\", plotdir=\"/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/figures/ClimandesIndizes/test3/\", plotnamestring = \"qth\")\nqth_obs$index\nqtot_obs <- calc_index(prec_obs,\"qtot\",thvar=\"prec\" ,aggregation=\"seasonal\",iformat=\"perc\", op=\">\",\n                      threshold=90  ,trend=TRUE, baseperiod=c(1982,1988), q=seq(0,1,0.1))\nplot_ts_stations(qtot_obs, trendplots=TRUE, output=\"png\", plotdir=\"/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/figures/ClimandesIndizes/test3/\", plotnamestring = \"qtot\")\nqtot_obs$index\n\ncsdi_obs <- calc_index(temp_obs,\"sdi\",thvar=\"tmin\",threshold=90, op=\">\",q= seq(0,1,0.1), baseperiod=c(1982,1988), aggregation=\"monthly\",  trend=FALSE)\nsdii_obs$index\nplot_ts_stations(sdii_obs, trendplots=TRUE, output=\"png\", plotdir=\"/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/figures/ClimandesIndizes/test3/\", plotnamestring = \"testdata\")\n\n\n",
    "created" : 1516710593944.000,
    "dirty" : false,
    "encoding" : "ISO8859-1",
    "folds" : "37|9|41|0|\n42|23|60|0|\n",
    "hash" : "1908922959",
    "id" : "B95EA9E0",
    "lastKnownWriteTime" : 1516711219,
    "last_content_update" : 1516711219605,
    "path" : "/prod/zue/climate/comm_serv/CLIMANDES_Data/src_C2/Rclimandes_2/imn_code/climandes-2/experiments/imn/calc_index_test.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}